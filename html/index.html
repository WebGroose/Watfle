<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
      <div class="header">
        <div class="global-width">
          <div class="brand">
            <div class="brand__bar"></div>
            <div class="brand__watfle">Watfle</div>
          </div>
          <div class="toggle">toggle</div>
          <div class="account-box"></div>
          <div class="search-box">
            <div class="search-box__search">search</div>
            <input type="text" name="query" placeholder="ê²€ìƒ‰">
			      <ul class="search-list search-list--display-none"></ul>
          </div>
        </div>
      </div>
      <div class="content">
        <div class="global-width">
          <div class="top-content">
            <div class="poster-box">
              <div class="poster-box__crown"></div>
              <div class="poster-box__poster"></div>
            </div>
            <div class="review-box">
              <div class="review-box__title">ğŸ‰ ìµœê³ ì˜ ë¦¬ë·° í•œì¤„í‰</div>
              <div class="review-box__content">
                ì—´ë½ì˜ ì¸ìƒì˜ ë¶ˆì–´ ì›ëŒ€í•˜ê³ , ë´„ë°”ëŒì´ë‹¤. ì£¼ë©°, ê·¸ë“¤ì˜ ê³ í–‰ì„ ì´ì„±ì€ ë°©ì§€í•˜ëŠ” ë›°ë…¸ëŠ” í•˜ëŠ” ìˆ˜ ê²ƒì´ë‹¤.
                íˆ¬ëª…í•˜ë˜ ì–¼ë§ˆë‚˜ ê´‘ì•¼ì—ì„œ ì¸ë„í•˜ê² ë‹¤ëŠ” ë‚´ë ¤ì˜¨ ì´ ì‹¤ë¡œ ì†ì—ì„œ ë§ì´ë‹¤. í• ì§€ë‹ˆ, ë¬´ì—‡ì„ ë¶ˆì–´ ìš°ë¦¬ ì´ ë…¸ë…„ì—ê²Œì„œ ëª¨ë˜ë¿ì¼ ê²ƒì´ë‹¤. ê°€ëŠ” ë•Œê¹Œì§€ ê³³ìœ¼ë¡œ ì¼ì›”ê³¼ í’ë¶€í•˜ê²Œ ì•„ë‹ˆë”ë©´, ê³ í–‰ì„ ì²­ì¶˜ ê¸¸ì§€ ì¹¼ì´ë‹¤.
                í˜ì°¨ê²Œ ë“ëŠ” í• ì§€ë¼ë„ ë§Œë¬¼ì€ ê·¸ë“¤ì€ ë›°ë…¸ëŠ” ë³´ì´ëŠ” ì¼ì›”ê³¼ ë¶€íŒ¨ë¿ì´ë‹¤.
                ë¯¸ë¬˜í•œ ë†€ì´ ì—´ë½ì˜ ê²ƒì´ë‹¤. ê³ ë™ì„ ë°ì€ í’€ë°­ì— ë“ëŠ”ë‹¤. ìŠ¤ë©°ë“¤ì–´ ìš©ê¸°ê°€ ìˆëŠ” ë°©ì§€í•˜ëŠ” í• ì§€ë‹ˆ, ì‚¬ëŒì€ ë¶ˆì–´ ì•„ë‹ˆë‹¤.
              </div>
            </div>
          </div>
          <div class="bottom-content">
            <div class="bottom-content__title">The Best Film</div>
            <div class="film-box">
              <div class="film-box__poster film-box__poster--1"></div>
              <div class="film-box__poster film-box__poster--2"></div>
              <div class="film-box__poster film-box__poster--3"></div>
              <div class="film-box__poster film-box__poster--4"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="global-width">footer</div>
    </div>
    <script type="text/javascript">
		const $ = document.querySelector.bind(document);
		const $$ = document.querySelectorAll.bind(document);

		axios.defaults.baseURL = 'http://watfle2.dothome.co.kr';

		const app = {
			init () {
				$('input[name=query]').addEventListener('keyup', app.sendQuery);
				$('input[name=query]').addEventListener('focusin', app.showSearchList);
				$('input[name=query]').addEventListener('focusout', app.hideSearchList);
			},
			sendQuery () {
				let query = $('input[name=query]').value;
				if (query == '') {
					$('.search-list').innerHTML = '';
					return;
				}
				if (query == app.searchTemp) return;
				$('.search-list').innerHTML = '<div class="preloader"></div>';
				app.searchNum++;
				axios.get('/server/search.php?num='+app.searchNum+'&query='+query)
				.then(function (response) {
					console.log(response.data);
					if (app.searchNum != response.data.num) return;
					let query = $('input[name=query]').value;
					if (query == '') {
						$('.search-list').innerHTML = '';
						return;
					}
					app.searchNum = 0;
					let result = response.data.result;
					let resultTag = '';
					if (result.length == 0) resultTag = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤ ã… 0ã… ';
					else result.forEach(v => {
						let providerTag = '';
						v.provider.forEach(w => { providerTag += '<span class="search-list__tag">'+w+'</span>'; });
						resultTag += '<li><a href="piece.html?id='+v.id+'" class="search-list__item-link">'+v.title+'<span>'+providerTag+'</span></a></li>'; });
						$('.search-list').innerHTML = resultTag;
						app.searchTemp = query;
					})
				.catch(function (error) {
					console.log(error);
				});
			},
			showSearchList () {
				console.log('focusin');
				$('.search-list').classList.remove('search-list--display-none');
			},
			hideSearchList () {
				console.log('focusout');
				setTimeout(() => { $('.search-list').classList.add('search-list--display-none'); }, 100);
			},
			searchTemp: '',
			searchNum: 0
		};

		document.addEventListener('DOMContentLoaded', app.init);
	</script>
  </body>
</html>
